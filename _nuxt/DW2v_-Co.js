import{_ as ce}from"./Dth0woYn.js";import{_ as de}from"./B9RpFVCU.js";import{_ as ue}from"./8emk-Re0.js";import pe from"./DBThNqmy.js";import{_ as me,u as _e,g as ge,aH as he,aI as ve,r as u,h as fe,i as be,H as ke,o as l,c as d,a as e,n as T,k as a,F as E,l as j,b as M,w as Z,aP as we,N as ee,x as ye,aK as xe,t as C,j as F,v as O,y as te,q as h,d as Te,aJ as Me,p as Ce,e as Ie}from"./CPOyUOu7.js";import{h as Se}from"./CfWT8nGG.js";import{s as Pe}from"./B3N_J3ZF.js";import"./DlZmmtGM.js";const b=$=>(Ce("data-v-9ab946a0"),$=$(),Ie(),$),Re={class:"col-md-9"},$e={class:"page-content-box"},Ne=we('<div class="responsive-support d-flex align-items-center" data-v-9ab946a0><h1 class="sectitle" data-v-9ab946a0>Solicitar suporte</h1><button class="ticket-button button-props" data-bs-toggle="modal" data-bs-target="#modal-open-ticket" data-v-9ab946a0> abrir ticket </button></div><p class="page-description" data-v-9ab946a0> Precisa de ajuda? abra um ticket e converse com um dos nossos desenvolvedores preparados. </p><p class="text-props mt-4 mb-4" data-v-9ab946a0>Tickets abertos: <span class="hyper-color" data-v-9ab946a0>2</span></p>',3),De={class:"ticket-card border-props"},Ue={class:"props"},Be=b(()=>e("h1",null,"Título:",-1)),He=b(()=>e("h1",null,"Status:",-1)),Ve={class:"rendered-elements"},Ee=["onClick"],je=b(()=>e("span",{class:"warning"},"Horário de atendimento: 13h às 21h de segunda a sexta. (Exceto aos feriados)",-1)),Fe={class:"table-responsive"},Oe={class:"table-card-rounded"},Je={class:"table"},qe=b(()=>e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Ticket"),e("th"),e("th",{scope:"col"},"Status")])],-1)),Ae=["onClick"],Le=b(()=>e("td",null,null,-1)),ze={class:"status hyper-color"},Ge={class:"page-right"},Ke={class:"input-group"},We={class:"input-item mt-0"},Qe=b(()=>e("label",{for:"title"},"Titulo do seu ticket",-1)),Xe={class:"input-item"},Ye=b(()=>e("label",{for:"help-ticket"},"Como podemos te ajudar?",-1)),Ze={class:"chat-container"},et=["onClick"],tt=["innerHTML"],at={key:0,class:"mt-3"},st={for:"file-choose"},ot=["disabled"],nt={key:1,id:"chat",value:"Este ticket foi fechado pelo admnistrador",class:"border-props",name:"chat",disabled:!0,rows:"1"},lt=["disabled"],it=["disabled"],rt={__name:"tickets",setup($){_e({title:"Solicitar suporte via ticket"});const m=ge(),ae=he(),J=ve(ae),k=u({limit:15,search:null,currentPage:1}),B=u(!1),H=u(!0),q=u(null),N=u(null),D=u(Se),v=u(!1),U=u(!0),g=u(null),I=u(null),i=u({title:null,message:null,images:null}),f=u({text:null,images:null,user:{username:"edummelo",avatarUrl:"images/augustocherrycode.jpg"},answer:!1,loading:!0});let r={};const S=u([]),V=async()=>{H.value=!0;const t=await m.$axios.customer.listTickets({limit:k.value.limit,search:k.value.search});D.value=t,H.value=!1},se=t=>{k.value.currentPage=Number(t)},oe=t=>{i.value.images=t.target.files[0]},A={text:`
<p>Informe como podemos ajudar você e aguarde um de nossa equipe entrar em contato por este mesmo chat</p>
🕐 Horario de atendimento: <strong>Segunda a Sexta (13h as 21h)</strong> exceto feriados.`,images:null,user:{id:"dsfsddsfd",username:"augusto",avatarUrl:"images/hyper-main-logo.png"},answer:!1,loading:!1,html:!0},ne=async()=>{if(B.value=!0,S.value=[A],!i.value.title||!i.value.message){m.$toast.error("Informe o titulo e a mensagem para abrir um ticket.");return}const t=await m.$axios.customer.createTicket(i.value.title),s=new FormData;if(s.append("message",i.value.message),typeof t!="string"){I.value=t._id;const p=await m.$axios.customer.createMessage(t==null?void 0:t._id,s);t.ticket={title:i.value.title,...p},await z(t),setTimeout(()=>{r.emit("createMessage",p.toJSON())},1e3),v.value=!1,U.value=!1}await ee(),q.value.hide(),N.value.show(),await V(),i.value={title:null,message:null,images:null},B.value=!1},L=async t=>{var w,y;S.value=[A],g.value=t,I.value=t._id;const s=(y=(w=J.user)==null?void 0:w.value)==null?void 0:y._id;z(t),N.value.show(),U.value=!0;const p=await m.$axios.customer.getMessages(t._id);for(let c of p)c.setMainImage(m),r!=null&&r.emit&&r.emit("createMessage",c.getMessageReference(s)),S.value.push(c.getMessageReference(s));G(),K(),U.value=!1},z=async t=>{var s,p;if(((p=(s=g==null?void 0:g.value)==null?void 0:s.props)==null?void 0:p.closed)!==!0)return new Promise((w,y)=>{const c=Pe();c.on("connect",()=>{c.emit("ticketJoin",{_id:t._id,scoketId:c.id,ticket:ye(g.value)||t.ticket}),c.on("ticketJoined",()=>{console.log("[WS] Ticket Joined:",t._id),r=c,w(c)}),c.on("message",_=>{var P,R;if(I.value!==(_==null?void 0:_.ticketId))return;const n=new xe(_,_._id),x=(R=(P=J.user)==null?void 0:P.value)==null?void 0:R._id;n.setMainImage(m),S.value.push(n.getMessageReference(x)),G()}),c.on("ticketClosed",async _=>{_.ticketId===I.value&&(m.$toast.success("Seu ticket foi fechado pelo administrador"),N.value.hide(),c.close(),await V())})})})},le=async()=>{v.value=!0;const t=new FormData;if(f.value.text.length>=500){m.$toast.error("Você não pode enviar acima de 500 caracteres."),v.value=!1;return}i.value.images&&t.append("imagesUrl",i.value.images),t.append("message",f.value.text);const s=await m.$axios.customer.createMessage(I.value,t);r.emit("createMessage",s.toJSON()),i.value.images=null,K(),v.value=!1},ie=()=>{typeof(r==null?void 0:r.close)=="function"&&r.close()},G=async t=>{await ee();const s=document.getElementById("TicketChatModal");s.scrollTo(0,s.scrollHeight)},K=()=>{f.value.text=null,f.value.images=null},re=t=>{window.open(t.images,"_blank")};return fe(async()=>{await V()}),be(()=>{setTimeout(()=>{q.value=new bootstrap.Modal("#modal-open-ticket"),N.value=new bootstrap.Modal("#modal-open-chat-ticket")},500)}),ke(()=>{typeof(r==null?void 0:r.close)=="function"&&r.close()}),(t,s)=>{var _;const p=ce,w=de,y=ue,c=pe;return l(),d("div",Re,[e("div",$e,[Ne,e("div",{class:T(["row responsive-row",{"blur-loading":a(H)}])},[(l(!0),d(E,null,j((_=a(D)[a(k).currentPage])==null?void 0:_.slice(0,3),n=>(l(),d("div",De,[e("div",Ue,[Be,He,M(p,{src:"images/hyperscriptslogo.png"})]),e("div",Ve,[e("h1",null,C(n.props.title),1),e("p",null,[e("span",null,C(n.props.closedString.toUpperCase()),1)]),e("button",{onClick:x=>L(n),class:"chat-button button-props"}," abrir chat ",8,Ee)])]))),256)),je,e("div",Fe,[e("div",Oe,[e("table",Je,[qe,e("tbody",null,[(l(!0),d(E,null,j(a(D)[a(k).currentPage],n=>(l(),d("tr",{class:"cursor-table",onClick:x=>L(n)},[e("td",null,C(n.props.title),1),Le,e("td",ze,C(n.props.closedString),1)],8,Ae))),256))])])])]),e("div",Ge,[M(w,{onOnCurrentPage:se,pages:a(D),currentPage:a(k).currentPage},null,8,["pages","currentPage"])])],2)]),M(y,{id:"modal-open-ticket",modalTitle:"Abrir um ticket",secondBtn:!0,loading:a(B),onOnHideDialog:ne,secondBtnText:"Criar ticket"},{body:Z(()=>[e("form",Ke,[e("div",We,[Qe,F(e("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>a(i).title=n),type:"text",id:"title",class:"border-props",placeholder:"Escreva em poucas palavras!"},null,512),[[O,a(i).title]])]),e("div",Xe,[Ye,F(e("textarea",{"onUpdate:modelValue":s[1]||(s[1]=n=>a(i).message=n),name:"help-ticket",class:"border-props mt-1",id:"help-ticket",style:{width:"100%"},placeholder:"Descreva os detalhes aqui.",rows:"4"},null,512),[[O,a(i).message]])])])]),_:1},8,["loading"]),M(y,{id:"modal-open-chat-ticket",modalTitle:"Chat",onOnCancelDialog:ie,class:"modal-xl","data-bs-backdrop":"static"},{body:Z(()=>{var n,x,P,R,W,Q,X,Y;return[e("div",{id:"TicketChatModal",class:T(["border-props p-4 scroll-anchor",{"blur-loading":a(U)}])},[e("div",Ze,[(l(!0),d(E,null,j(a(S),o=>(l(),d("div",{class:T(["chat-item",{"loading-message":o.loading}])},[o.answer?h("",!0):(l(),te(p,{key:0,src:o.user.avatarUrl,class:"profile-chat"},null,8,["src"])),o.html?h("",!0):(l(),d("div",{key:1,class:T(["message-area",{"chat-body":!o.answer,"chat-body-answer":o.answer}])},[Te(C(o.text)+" ",1),o.images?(l(),d("div",{key:0,class:"profile-image-attachment",onClick:ct=>re(o)},[M(p,{src:o.images},null,8,["src"])],8,et)):h("",!0)],2)),o.html?(l(),d("div",{key:2,class:T(["message-area",{"chat-body":!o.answer,"chat-body-answer":o.answer}])},[e("span",{innerHTML:o.text},null,8,tt)],2)):h("",!0),o.answer?(l(),te(p,{key:3,src:o.user.avatarUrl,class:"profile-chat",loading:"lazy"},null,8,["src"])):h("",!0)],2))),256))])],2),e("form",{class:"d-flex",onSubmit:Me(le,["prevent"])},[(x=(n=a(g))==null?void 0:n.props)!=null&&x.closed?h("",!0):(l(),d("div",at,[e("label",st,[e("div",{class:T(["file-content",{"active-attach":a(i).images}])},[M(c,{name:"material-symbols:attach-file"}),e("input",{type:"file",id:"file-choose",onChange:oe,accept:"image/png, image/gif, image/jpeg",disabled:a(v)},null,40,ot)],2)])])),(R=(P=a(g))==null?void 0:P.props)!=null&&R.closed?(l(),d("textarea",nt)):h("",!0),(Q=(W=a(g))==null?void 0:W.props)!=null&&Q.closed?h("",!0):F((l(),d("textarea",{key:2,id:"chat","onUpdate:modelValue":s[2]||(s[2]=o=>a(f).text=o),class:"border-props",name:"chat",disabled:a(v),placeholder:"Converse com a equipe",rows:"1"},null,8,lt)),[[O,a(f).text]]),(Y=(X=a(g))==null?void 0:X.props)!=null&&Y.closed?h("",!0):(l(),d("button",{key:3,type:"submit",disabled:!a(f).text||a(v),class:"button-chat-send button-props"},C(a(v)?"Enviando...":"Enviar"),9,it))],32)]}),_:1})])}}},ft=me(rt,[["__scopeId","data-v-9ab946a0"]]);export{ft as default};
